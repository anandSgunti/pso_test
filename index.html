<!DOCTYPE html>
<html>
<head>
    <title>Interactive WebAR Model Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
    
    <style>
        .arjs-loader {
            position: fixed;
            z-index: 999;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 50px;
            height: 50px;
        }
        
        .arjs-loader div {
            position: absolute;
            width: 44px;
            height: 44px;
            margin: 8px;
            border: 4px solid #fff;
            border-radius: 50%;
            border-color: #fff transparent transparent transparent;
            animation: arjs-loader 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        }

        @keyframes arjs-loader {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-family: Arial, sans-serif;
            z-index: 1000;
            text-align: center;
            width: 80%;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">
        <div></div>
    </div>
    <div id="instructions">
        ‚ü≤ One finger rotate | ‚ÜîÔ∏è Two fingers scale | üëÜ Double tap to reset
    </div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;"
        vr-mode-ui="enabled: false"
        gesture-detector
        renderer="physicallyCorrectLights: true; colorManagement: true; exposure: 1.5;"
    >
        <a-marker preset="hiro" smooth="true" smoothCount="5">
            <!-- Directional Light -->
            <a-entity light="type: directional; 
                             color: #FFFFFF; 
                             intensity: 0.8; 
                             castShadow: true"
                      position="-1 1 1">
            </a-entity>

            <!-- Spot Light -->
            <a-entity light="type: spot; 
                             color: #FFFFFF; 
                             intensity: 1; 
                             angle: 45; 
                             penumbra: 0.2; 
                             castShadow: true"
                      position="0 3 0" 
                      rotation="-90 0 0">
            </a-entity>

            <!-- Model -->
            <a-entity
                id="model"
                position="0 0 0"
                rotation="0 0 0"
                scale="1 1 1"
                gltf-model="./reheart.glb"
                gesture-handler="minScale: 0.25; maxScale: 10"
                animation-mixer
                material="metalness: 0.2; roughness: 0.4;"
                shadow="cast: true; receive: true">
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        window.addEventListener('load', () => {
            const model = document.getElementById('model');
            const marker = document.querySelector('a-marker');
            
            marker.addEventListener('markerFound', () => {
                console.log('Marker detected');
            });

            // Double tap to reset
            let lastTap = 0;
            document.addEventListener('click', (event) => {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 500 && tapLength > 0) {
                    model.setAttribute('rotation', '0 0 0');
                    model.setAttribute('scale', '1 1 1');
                }
                lastTap = currentTime;
            });

            // Handle model loading
            model.addEventListener('model-loaded', () => {
                console.log('Model loaded');
                // Adjust material properties after model loads if needed
                model.setAttribute('material', {
                    metalness: 0.2,
                    roughness: 0.4
                });
            });
        });
    </script>
</body>
</html>
