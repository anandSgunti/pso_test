<!DOCTYPE html>
<html>
<head>
    <title>Interactive WebAR Model Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
    
    <style>
        #chat-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #chat-response {
            margin-top: 10px;
        }
        input, button {
            padding: 5px;
            margin: 5px;
            border-radius: 5px;
            border: none;
        }
        button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }

        #chat-container {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 300px; /* Fixed width */
    }

    #chat-response {
        margin-top: 10px;
        width: 100%;
        max-height: 100px; /* Fixed height */
        overflow-y: auto; /* Scroll if content exceeds height */
        text-align: left;
        padding: 5px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.1);
    }

    input {
        padding: 5px;
        margin: 5px;
        border-radius: 5px;
        border: none;
        width: 80%;
    }

    button {
        background: #4CAF50;
        color: white;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 5px;
        border: none;
    }

    /* Glow effect when the model reacts */
    @keyframes glow {
        0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 20px rgba(255, 255, 255, 1); }
        100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
    }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">
        <div></div>
    </div>
    <div id="instructions">
        ‚ü≤ One finger rotate | ‚ÜîÔ∏è Two fingers scale | üëÜ Double tap to reset
    </div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;"
        vr-mode-ui="enabled: false"
        gesture-detector
        renderer="physicallyCorrectLights: true; colorManagement: true; exposure: 2; toneMappingMethod: linear;"
    >
        <!-- Maximum Brightness Lighting Setup -->
        <a-entity light="type: ambient; intensity: 2; color: #FFFFFF"></a-entity>
        
        <a-marker preset="hiro" smooth="true" smoothCount="5">
            <!-- Intense Directional Lights -->
            <a-entity light="type: directional; 
                             color: #FFFFFF; 
                             intensity: 2; 
                             castShadow: true"
                      position="1 4 2">
            </a-entity>

            <a-entity light="type: directional; 
                             color: #FFFFFF; 
                             intensity: 1.5;" 
                      position="-1 4 -2">
            </a-entity>

            <a-entity light="type: point;
                             color: #FFFFFF;
                             intensity: 1.5;
                             distance: 100"
                      position="0 3 0">
            </a-entity>

            <!-- Model with Maximum Brightness Properties -->
            <a-entity
                id="model"
                position="0 0 0"
                rotation="0 0 0"
                scale="1 1 1"
                gltf-model="./reheart.glb"
                gesture-handler="minScale: 0.25; maxScale: 10"
                animation-mixer
                material="metalness: 0.1; 
                          roughness: 0.2; 
                          emissive: #FFFFFF; 
                          emissiveIntensity: 0.5; 
                          color: #FFFFFF;"
                shadow="cast: true; receive: false">
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <!-- Chat UI for AI Interaction -->
    <div id="chat-container">
        <input type="text" id="user-message" placeholder="Ask something...">
        <button onclick="sendMessage()">Send</button>
        <p id="chat-response">AI Assistant Ready...</p>
    </div>

    <script>
        AFRAME.registerComponent('max-brightness', {
            init: function() {
                const model = document.getElementById('model');
                const lights = document.querySelectorAll('[light]');

                // Maximize brightness on marker detection
                document.querySelector('a-marker').addEventListener('markerFound', () => {
                    lights.forEach(light => {
                        light.setAttribute('light', 'intensity', 3);
                    });

                    // Additional brightness enhancement
                    model.setAttribute('material', {
                        emissiveIntensity: 1,
                        metalness: 0.1,
                        roughness: 0.1
                    });

                    // Automatically request AI response
                    getChatResponse("Describe this AR object.");
                });
            }
        });

        window.addEventListener('load', () => {
            const model = document.getElementById('model');
            const marker = document.querySelector('a-marker');
            
            // Add max brightness component
            document.querySelector('a-scene').setAttribute('max-brightness', '');
            
            // Double tap reset functionality
            let lastTap = 0;
            document.addEventListener('click', (event) => {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 500 && tapLength > 0) {
                    model.setAttribute('rotation', '0 0 0');
                    model.setAttribute('scale', '1 1 1');
                }
                lastTap = currentTime;
            });
        });

        // Chatbot API Integration (Streaming AI Response)
    // Chatbot API Integration (Streaming AI Response)
    // Chatbot API Integration (Streaming AI Response)
    async function getChatResponse(userMessage) {
        const response = await fetch("https://ari-b6xq.onrender.com/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMessage })
        });

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let finalResponse = "";
        const chatResponseElement = document.getElementById("chat-response");
        const model = document.getElementById("model");

        chatResponseElement.innerText = ""; // Clear previous response
        chatResponseElement.scrollTop = 0; // Reset scroll

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            finalResponse += decoder.decode(value);
            chatResponseElement.innerText = finalResponse; // Update response in real-time

            // Auto-scroll as new text is added
            chatResponseElement.scrollTop = chatResponseElement.scrollHeight;
        }

        // Delay transformation after response is fully displayed
        setTimeout(() => {
            if (userMessage.toLowerCase().includes("broken heart syndrome")) {
                animateModel(true); // Special animation
            } else {
                animateModel(false); // Reset model
            }
        }, 500);
    }

    // Function to smoothly animate model changes
    function animateModel(enlarge) {
        const model = document.getElementById("model");

        if (enlarge) {
            model.setAttribute('animation', 'property: scale; to: 2.5 2.5 2.5; dur: 800; easing: easeOutElastic;');
            model.setAttribute('animation__rotate', 'property: rotation; to: 0 180 0; dur: 800; easing: easeOutCubic;');
        } else {
            model.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutElastic;');
            model.setAttribute('animation__rotate', 'property: rotation; to: 0 0 0; dur: 800; easing: easeOutCubic;');
        }
    }

    // Function to Send User Input to AI
    function sendMessage() {
        const userMessage = document.getElementById("user-message").value;
        if (userMessage) {
            document.getElementById("chat-response").innerText = "Thinking...";
            getChatResponse(userMessage);
        }
    }


    </script>
</body>
</html>





    
